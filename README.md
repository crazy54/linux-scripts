# AWS Python Runtime Upgrade Script

## Overview

This repository contains a bash script (`upgrade_python_runtimes.sh`) designed to help automate the process of upgrading Python runtimes for AWS Lambda functions and AWS Systems Manager (SSM) Automation documents to a target Python version (e.g., Python 3.10).

## Features

- **Lambda Function Upgrades**:
    - Identifies Lambda functions using specified older Python runtimes (e.g., python3.9, python3.8, python2.7).
    - Updates the runtime of these identified Lambda functions to the configured target Python version.
- **Systems Manager Automation Upgrades (Simulated/Placeholder)**:
    - Includes placeholder logic for identifying SSM Automation documents that use outdated Python runtimes.
        - **Important**: Actual identification of such SSM documents is complex as it requires parsing the content of each document. The script currently expects a manually populated file (`ssm_automations_to_update.txt`) or integration with a more advanced script for this identification step.
    - Simulates the process of updating the Python runtime within SSM Automation documents. This involves:
        - Simulating fetching the document content.
        - Simulating the modification of the `Runtime` parameter in `aws:executeScript` steps.
        - Simulating the `update-document` call.
- **Logging**:
    - All major operations and outcomes are logged to `upgrade_runtimes.log`.
- **Configurable**:
    - Target Python runtime and lists of old runtimes can be configured within the script.

## Prerequisites

1.  **AWS CLI**: The script relies on the AWS Command Line Interface. Ensure it is installed and configured with necessary permissions to:
    *   `lambda:ListFunctions`
    *   `lambda:UpdateFunctionConfiguration`
    *   `ssm:ListDocuments` (for a more advanced identification)
    *   `ssm:GetDocument`
    *   `ssm:UpdateDocument`
2.  **jq (Optional but Recommended for SSM)**: For more advanced or non-simulated SSM document parsing and manipulation (if you extend the script), `jq` is a useful command-line JSON processor. The current script's SSM part is heavily simulated and does not directly require `jq` for its placeholder logic.
3.  **Bash Environment**: A Unix-like environment with bash.

## How to Use

1.  **Configure the Script**:
    *   Open `upgrade_python_runtimes.sh`.
    *   Modify `TARGET_PYTHON_RUNTIME` to your desired Python version (e.g., `python3.10`).
    *   Update `OLD_PYTHON_RUNTIMES` array with the list of Python runtimes you want to upgrade from.

2.  **Prepare SSM Automation List (if applicable)**:
    *   If you intend to update SSM Automations, you need to identify the documents that require updates.
    *   Create a file named `ssm_automations_to_update.txt` and list the names of the SSM Automation documents (one per line) that you want the script to process.
    *   Alternatively, modify the `identify_ssm_automations` function in the script if you have a programmatic way to generate this list.

3.  **Execute the Script**:
    ```bash
    chmod +x upgrade_python_runtimes.sh
    ./upgrade_python_runtimes.sh
    ```

4.  **Review Logs**:
    *   Check `upgrade_runtimes.log` for details of the operations performed, successes, and any errors.
    *   Examine `lambda_functions_to_update.txt` (generated by the script) to see which Lambda functions were targeted.

## Important Considerations & Limitations

*   **AWS CLI Dependency**: The script constructs and executes AWS CLI commands. It will not work without the AWS CLI installed and properly configured with credentials that have sufficient permissions.
*   **SSM Automation Complexity**:
    *   The parts of the script dealing with Systems Manager Automations are **highly simplified and largely simulated**.
    *   Identifying SSM Automations that use a specific Python runtime within their `aws:executeScript` steps requires parsing the content (JSON or YAML) of each document. This script provides a placeholder for this identification and expects a pre-populated list of target documents.
    *   The update process for SSM Automations (modifying document content) is also simulated. A robust solution for SSM document updates should involve careful parsing and modification of the document structure, ideally using an SDK like Boto3 in a Python script, rather than shell-based text manipulation.
*   **Error Handling**: The script includes basic error checking for AWS CLI command execution but might not cover all edge cases.
*   **Testing**: **Thoroughly test this script in a non-production environment** before running it against critical resources. Verify the changes made to Lambda functions and (if you implement non-simulated SSM updates) SSM documents.
*   **Idempotency**:
    *   The Lambda update part is generally idempotent (re-running it on an already updated function won't cause issues).
    *   The SSM update simulation, as written, would re-simulate the update each time. A real implementation should be designed with idempotency in mind.

## Files

*   `upgrade_python_runtimes.sh`: The main executable bash script.
*   `lambda_functions_to_update.txt`: Generated by the script; lists Lambda functions identified for updates.
*   `ssm_automations_to_update.txt`: Should be manually created or generated; lists SSM Automations targeted for updates.
*   `upgrade_runtimes.log`: Log file detailing script execution.
*   `README.md`: This file.

## Contributing

Feel free to adapt or extend this script to better suit your needs. For complex SSM document manipulations, consider using AWS SDKs (e.g., Boto3 for Python) for more robust and reliable parsing and updates.
